# 功能规格说明：待办事项与AI智能助手

**功能分支**: `001-todo-ai-assistant`
**创建日期**: 2025-11-27
**状态**: 草稿
**输入**: 用户描述："代办事项以及AI智能体问答 高效处理工作以及代办事项一建处理"

## 澄清

### 会话 2025-11-27

- Q: 后端数据同步机制 - 待办清单通过后端推送时，使用WebSocket实时推送、HTTP长轮询、短轮询还是混合模式？ → A: WebSocket实时推送
- Q: 小窗口模式的视觉呈现 - 缩小到桌面右下角时，使用动态虚拟形象、简洁圆形图标、迷你任务预览还是动画+图标组合？ → A: 简洁圆形图标
- Q: 多智能体选择机制 - 用户如何选择和切换不同的AI助手：固定多标签页、智能体设置预配置、智能体列表选择还是上下文内切换？ → A: 智能体列表选择
- Q: 未读角标的触发规则 - 小窗口模式下，角标显示哪些未读事件：消息和任务双重计数、仅AI消息、仅高优先级事件还是聚合通知点？ → A: 消息和任务双重计数
- Q: 用户身份验证方式 - 应用如何管理用户身份：邮箱密码、第三方OAuth、邮箱+第三方组合还是设备绑定？ → A: 暂时不需要用户认证，后期可能需要获取设备的域账户信息

## 用户场景与测试 *(必填)*

### 用户故事1 - 创建和管理待办事项 (优先级: P1)

用户可以快速创建、查看、编辑和完成待办事项，帮助他们组织和跟踪日常工作任务。用户可以为任��设置优先级、截止日期，并标记任务完成状态。

**为什么是此优先级**: 这是核心功能，是整个应用的基础。没有待办事项管理，其他功能无法发挥作用。这个功能本身就能提供价值,用户可以立即开始管理他们的任务。

**独立测试**: 可以通过创建新任务、修改任务属性、标记任务为完成状态来完全测试。提供的价值是用户能够组织和跟踪他们的工作。

**验收��景**:

1. **Given** 用户打开应用，**When** 用户点击"添加任务"按钮并输入任务标题，**Then** 新任务出��在任务列表中
2. **Given** 任务列表中有多个任务，**When** 用户点击任务的复选框，**Then** 任务标记为已完成并显示完成状态
3. **Given** 用户选中一个任务，**When** 用户修改任务的标题或优先级，**Then** 更改立即保存并反映在任务列表中
4. **Given** 用户创建了多个任务，**When** 用户关闭应用并重新打开，**Then** 所有任务及其状态都被保留

---

### 用户故事2 - AI智能助手对话 (优先级: P2)

用户可以通过自然语言与多个AI助手对话，提出问题并获得帮助。用户可以在对话界面顶部的选择器中切换不同的AI助手（如GPT-4、Claude、专业领域助手等），每个助手有不同的特长。AI助手可以回答一般性问题、提供建议，并帮助用户解决工作中的问题。

**为什么是此优先级**: 这是应用的差异化功能，增加了智能化体验。多智能体支持让用户根据任务选择最合适的AI。但它独立于待办事项功能，可以在核心任务管理功能完成后添加。

**独立测试**: 可以通过选择不同智能体、发送各种类型的消息并验证响应的质量和相关性来测试。提供的价值是用户获得即时的智能帮助和多样化的AI助手选择。

**验收场景**:

1. **Given** 用户打开AI助手界面，**When** 用户点击智能体选择器，**Then** 显示可用的AI助手列表（名称、简介、图标）
2. **Given** 用户选择了特定智能体，**When** 用户输入问题并发送，**Then** 所选AI助手在合理时间内返回相关的回答
3. **Given** 用户正在与某个AI对话，**When** 用户切换到另一个智能体，**Then** 对话历史切换到新智能体的历史记录
4. **Given** 用户正在与AI对话，**When** 用户发送多条消息，**Then** AI助手保持对话上下文并提供连贯的回答
5. **Given** AI助手正在处理请求，**When** 响应生成中，**Then** 用户看到加载指示器
6. **Given** 用户完成对话，**When** 用户关闭对话窗口后重新打开，**Then** 历史对话记录被保留，且记住上次使用的智能体

---

### 用户故事3 - AI辅助待办事项管理 (优先级: P3)

用户可以通过自然语言请求AI助手帮助创建、修改或组织待办事项。例如，用户可以说"帮我添加明天下午3点的会议任务"，AI会自动创建相应的任务。

**为什么是此优先级**: 这是高级集成功能，结合了故事1和故事2的能力。它提供了更流畅的用户体验，但需要前两个功能都已实现才有意义。

**独立测试**: 可以通过向AI发送任务创建/修改的自然语言指令，并验证待办事项列表是否正确更新来测试。提供的价值是更自然、更高效的任务管理方式。

**验收场景**:

1. **Given** 用户在AI对话中，**When** 用户说"添加一个任务：明天完成报告"，**Then** 新任务自动添加到待办列表，包含正确的标题和截止日期
2. **Given** 待办列表中有多个任务，**When** 用户请求AI"按优先级排序我的任务"，**Then** 任务列表重新排列并显示优化建议
3. **Given** 用户有多个待办任务，**When** 用户询问AI"我今天需要做什么"，**Then** AI总结今天截止或高优先级的任务
4. **Given** 用户通过AI创建了任务，**When** 用户在待办列表中查看，**Then** 任务正确显示所有AI解析的属性（标题、截止日期、优先级）

---

### 用户故事4 - 桌面常驻小窗口模式 (优先级: P2)

用户可以将应用缩小为桌面右下角的圆形图标，保持应用常驻而不占用任务栏空间。图标显示应用logo，当有未读消息或任务更新时显示角标提醒。用户可以拖动图标位置，双击图标恢复完整窗口。

**为什么是此优先级**: 这是桌面应用的重要体验功能，让用户在工作时保持应用可见但不干扰。它提供快速访问和及时通知，但需要基础功能（任务管理和AI对话）已实现。

**独立测试**: 可以通过缩小窗口、拖动图标、接收推送通知、双击恢复来测试。提供的价值是便捷的桌面常驻访问和实时通知。

**验收场景**:

1. **Given** 用户在完整窗口模式，**When** 用户点击缩小按钮或使用快捷键，**Then** 应用缩小为桌面右下角的圆形图标
2. **Given** 小窗口图标显示在桌面，**When** 用户拖动图标，**Then** 图标位置更新并记住用户偏好
3. **Given** 应用处于小窗口模式，**When** 后端推送新消息或任务更新，**Then** 圆形图标右上角显示未读角标
4. **Given** 小窗口图标显示，**When** 用户双击图标，**Then** 应用恢复为完整窗口，显示在之前的位置和大小
5. **Given** 用户打开完整窗口查看消息，**When** 用户处理完通知，**Then** 角标数字清除或减少

---

### 边界情况

- 当用户创建的任务标题为空或仅包含空格时会发生什么？
- 当用户网络断开时发送AI消息会如何处理？
- 系统如何处理AI响应超时或错误的情况？
- 当待办事项数量达到很大数量（如1000+）时，性能如何保证？
- 如果用户同时在多个窗口中修改同一任务会发生什么？
- 当AI助手的响应非常长时，如何显示和处理？
- 如果AI误解用户的意图创建了错误的任务，用户如何轻松撤销或修改？
- 当未读角标数量超过99时如何显示（显示"99+"还是具体数字）？
- 小窗口图标被拖动到屏幕边缘外时如何处理？
- 如果用户在小窗口模式下收到大量推送通知（如50+），角标和性能如何处理？
- WebSocket断开期间收到的推送消息，重连后如何同步未读状态？
- 用户切换智能体时，未读消息计数是按智能体分别统计还是合并统计？

## 需求 *(必填)*

### 功能需求

#### 待办事项管理

- **FR-001**: 系统必须允许用户创建新的待办任务，包含标题、描述、优先级（高/中/低）和截止日期
- **FR-002**: 系统必须允许用户查看所有待办任务的列表，并支持按状态（未完成/已完成）筛选
- **FR-003**: 系统必须允许用户编辑现有任务的所有属性
- **FR-004**: 系统必须允许用户标记任务为已完成或未完成
- **FR-005**: 系统必须允许用户删除任务
- **FR-006**: 系统必须通过WebSocket连接实时接收后端推送的待办任务更新
- **FR-007**: 系统必须在本地持久化存储所有待办任务数据，作为离线缓存和快速访问
- **FR-008**: 系统必须支持任务排序（按创建时间、截止日期、优先级）
- **FR-009**: 系统必须在macOS和Windows平台上提供一致的待办事项管理体验
- **FR-010**: 系统必须在WebSocket连接断开时显示连接状态，并自动尝试重连

#### AI智能助手

- **FR-011**: 系统必须提供对话界面，允许用户输入文本消息
- **FR-012**: 系统必须在对话界面顶部显示智能体选择器，列出所有可用的AI助手
- **FR-013**: 智能体列表必须显示每个AI的名称、简短描述和图标
- **FR-014**: 用户必须能够切换智能体，切换后立即生效于后续对话
- **FR-015**: 系统必须为每个智能体独立保存对���历史记录
- **FR-016**: 系统必须将用户消息发送到当前选中的AI服务并显示响应
- **FR-017**: 系统必须保持对话历史记录，在会话期间保留上下文
- **FR-018**: 系统必须在AI处理请求时显示加载状态指示器
- **FR-019**: 系统必须处理AI服务错误并向用户显示友好的错误消息
- **FR-020**: 系统必须支持流式显示AI响应（逐字显示而非等待完整响应）
- **FR-021**: 系统必须本地持久化存储每个智能体的对话历史记录
- **FR-022**: 系统必须允许用户清除特定智能体的对话历史或开始新对话
- **FR-023**: 系统必须记住用户上次使用的智能体，下次打开时默认选中

#### AI辅助任务管理

- **FR-024**: 系统必须能够解析用户的自然语言输入，识别任务创建意图
- **FR-025**: 系统必须从自然语言中提取任务属性（标题、截止日期、优先级）
- **FR-026**: 系统必须在AI创建任务前向用户确认解析结果
- **FR-027**: 系统必须允许AI助手查询当前的待办任务列表以回答用户问题
- **FR-028**: 系统必须支持通过AI对现有任务进行修改和删除操作

#### 桌面窗口管理

- **FR-029**: 系统必须支持将完整窗口缩小为桌面常驻的圆形图标模式
- **FR-030**: 圆形图标必须默认显示在桌面右下角，尺寸适中且不遮挡其他内容
- **FR-031**: 用户必须能够拖动圆形图标到桌面任意位置，位置偏好需持久化保存
- **FR-032**: 圆形图标必须显示应用logo，设计简洁清晰
- **FR-033**: 系统必须跟踪未读AI消息数量和未读任务更新数量
- **FR-034**: 当有未读消息或任务更新时，圆形图标右上角必须显示数字角标，显示未读总数（消息+任务）
- **FR-035**: 未读角标必须实时更新，通过WebSocket推送触发
- **FR-036**: 用户打开完整窗口并查看消息或任务后，对应的未读计数必须清除
- **FR-037**: 用户双击圆形图标时，必须恢复完整窗口到之前的位置和大小
- **FR-038**: 系统必须记住窗口状态（完整/小窗口），应用重启后恢复上次状态
- **FR-039**: 小窗口模式下，图标必须始终显示在其他窗口之上（topmost）

#### 跨平台要求

- **FR-040**: 系统必须在macOS和Windows上使用平台原生的文件选择对话框（如果涉及文件导入/导出）
- **FR-041**: 系统必须支持平台适配的键盘快捷键（macOS使用Cmd，Windows使用Ctrl）
- **FR-042**: 系统必须适配不同的窗口大小和分辨率
- **FR-043**: 系统必须支持平台原生的通知（用于任务提醒功能）

### 关键实体

- **待办任务（Task）**: 代表用户需要完成的工作项，包含唯一标识符、标题、可选描述、优先级（高/中/低）、截止日期（可选）、创建时间、完成状态（布尔值）、完成时间（可选）
- **AI智能体（AIAgent）**: 代表一个可用的AI助手，包含唯一标识符、名称、描述、图标URL、服务端点、模型参数配置
- **对话消息（Message）**: 代表AI对话中的单条消息，包含唯一标识符、内容文本、发送者（用户/AI）、时间戳、会话标识符（用于分组消息）、关联的智能体标识符
- **对话会话（Conversation）**: 代表与特定智能体的一次完整对话交互，包含唯一标识符、关联的智能体标识符、创建时间、最后更新时间、消息列表的引用
- **任务操作（TaskAction）**: 代表AI执行的任务相关操作，包含操作类型（创建/修改/删除/查询）、目标任务引用、操作时间、用户确认状态
- **通知角标（Badge）**: 代表未读通知状态，包含未读消息数量、未读任务更新数量、最后更新时间

## 成功标准 *(必填)*

### 可衡量的结果

- **SC-001**: 用户可以在5秒内创建一个新的待办任务并看到它出现在列表中
- **SC-002**: AI助手在3秒内开始响应用户的问题（开始流式输出）
- **SC-003**: 系统可以流畅处理至少500个待办任务而不出现明显的性能下降
- **SC-004**: 90%的AI辅助任务创建请求能够正确解析任务属性（标题和截止日期）
- **SC-005**: 应用启动时间在macOS和Windows平台上均不超过2秒
- **SC-006**: 100%的用户数据在应用崩溃或强制关闭后能够恢复
- **SC-007**: 对话历史可以保存至少100条消息记录而不影响性能
- **SC-008**: 用户在离线状态下仍然可以完整使用待办事项管理功能（AI功能除外）
- **SC-009**: 应用在macOS和Windows上的界面布局和交互行为保持一致
- **SC-010**: 85%的用户能够在首次使用时成功完成基本任务（创建任务、与AI对话）而无需查看帮助文档

## 假设

1. **AI服务集成**: 假设应用将通过API连接到外部AI服务（如OpenAI、Anthropic Claude等），需要网络连接才能使用AI功能
2. **数据同步架构**: 应用采用客户端-服务器架构，通过WebSocket实时同步待办任务数据。本地存储作为主要数据源，在线时与服务器双向同步
3. **用户身份管理**: 当前版本不需要用户登录或注册，应用启动后直接可用。数据通过设备标识或匿名会话与后端关联。后期版本可能集成域账户支持（Windows域账户或macOS系统账户）
4. **语言支持**: 假设主要支持中文界面和中文AI对话，英文为次要支持语言
5. **任务提醒**: 假设任务提醒功能通过系统通知实现，不包含邮件或其他形式的提醒
6. **多智能体支持**: 假设支持多个AI智能体（如GPT-4、Claude、专业领域助手等），用户可通过界面选择器切换，每个智能体独立维护对话历史
7. **智能体配置**: 假设可用的AI智能体列表由后端配置或本地预设，初始版本包含2-5个常用智能体
8. **离线功能**: 假设待办事项在离线时可以本地查看和编辑，在线后通过WebSocket同步到服务器；AI功能需要网络连接
9. **数据隐私**: 假设发送给AI的对话内容由第三方AI服务提供商处理，需要在用户协议中说明
10. **WebSocket可靠性**: 假设应用会处理WebSocket连接中断，实现自动重连和离线队列机制
11. **桌面窗口特性**: 假设小窗口模式使用Flutter的桌面特定API实现，保持在其他窗口之上（always-on-top）
12. **数据隔离**: 由于不需要用户登录，假设每个设备的数据相互独立，不支持跨设备同步（除非后期引入域账户支持）
