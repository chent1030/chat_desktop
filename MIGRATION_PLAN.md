# WPF 迁移进度跟踪

说明：本文件用于同步迁移进度。每完成一项，请将对应条目标记为 `[x]`，并在“变更记录”中追加一行。

## 进度总览

- 当前阶段：阶段 3（核心业务迁移）
- 完成度：99%

## 阶段 1：准备与架构

- [ ] 1.1 确认需求范围（Windows-only，保留所有功能）
- [ ] 1.2 功能清单冻结（含悬浮窗/小窗改为 WPF 实现）
- [ ] 1.3 技术栈确认（WPF + MVVM + SQLite/LiteDB + MQTTnet）
- [ ] 1.4 架构与模块对照表输出（Flutter -> WPF）
- [ ] 1.5 迁移里程碑与验收标准定义

## 阶段 2：基础工程与基础设施

- [x] 2.1 创建 WPF 解决方案与项目结构（MVVM）
- [x] 2.2 配置管理（.env 解析 + 本地配置持久化）
- [x] 2.3 日志系统（滚动日志 + 崩溃日志）
- [x] 2.4 本地存储方案落地（SQLite + Dapper Schema）
- [x] 2.5 数据模型与迁移脚本（Task/Message/Conversation/TaskAction）
- [x] 2.6 HTTP 客户端封装（统一错误处理）
- [x] 2.7 SSE 客户端封装（流式响应）
- [x] 2.8 MQTT 基础连接与订阅框架
- [x] 2.9 资源管理（图标/GIF/字体）

## 阶段 3：核心业务迁移（任务 + AI 对话）

- [x] 3.1 任务模型与本地 CRUD（接口与 Dapper 实现）
- [x] 3.2 任务筛选/排序/搜索/统计（ViewModel + WPF 骨架）
- [x] 3.3 任务远端 API（Unify 接口）
- [x] 3.4 任务详情与外部联动（Outlook/DingTalk）
- [ ] 3.5 AI 对话模型与会话管理
- [x] 3.6 AI 流式对话（SSE）
- [x] 3.7 Markdown 渲染

## 阶段 4：语音与派发能力

- [x] 4.1 录音能力（Windows WAV）
- [x] 4.2 语音转文字接口接入
- [x] 4.3 语音创建任务（抽取 + 规则兜底）
- [x] 4.4 派发候选列表接口

## 阶段 5：窗口与系统集成

- [ ] 5.1 主窗口样式与行为（最小尺寸/透明效果）
- [ ] 5.2 系统托盘（显示/退出）
- [ ] 5.3 小窗/悬浮窗（WPF 重写）
- [ ] 5.4 悬浮窗与主窗通信（未读任务同步/双击恢复）

## 阶段 6：联调、测试与发布

- [ ] 6.1 端到端功能回归
- [ ] 6.2 日志与异常验证
- [ ] 6.3 打包与发布流程（Windows）

## 迁移执行清单（细化）

### 阶段 1：准备与架构
- [ ] 1.1 需求确认：Windows-only、保留全部功能、小窗/悬浮窗改 WPF
- [ ] 1.2 功能清单冻结：任务/AI/语音/MQTT/托盘/外部联动
- [ ] 1.3 技术栈定稿：WPF + MVVM + SQLite(Dapper) + MQTTnet
- [ ] 1.4 模块对照：Flutter Provider -> ViewModel，Service -> Service
- [ ] 1.5 验收标准：功能逐项对齐 + 日志/崩溃可追踪

### 阶段 2：基础工程与基础设施
- [x] 2.1 创建解决方案：主应用 + 公共库（Models/Services）
- [x] 2.2 配置管理：.env 解析 + AppData 本地配置
- [x] 2.3 日志：文件滚动日志 + Crash 捕获
- [x] 2.4 数据库初始化：SQLite 文件 + Schema
- [x] 2.5 数据模型：Task/Conversation/Message/TaskAction
- [ ] 2.6 HTTP 客户端：基础地址/Token/错误映射
- [ ] 2.7 SSE 客户端：流式响应解析
- [ ] 2.8 MQTT 框架：连接、订阅、重连、回调
- [ ] 2.9 资源：图标/GIF/字体加载

### 阶段 3：核心业务迁移（任务 + AI 对话）
- [ ] 3.1 任务 CRUD：创建/编辑/删除/完成/已读
- [ ] 3.2 任务筛选/排序/统计/搜索
- [x] 3.3 Unify API：创建/已读/完成/分页
- [ ] 3.4 任务详情：Markdown 展示 + 外部联动
- [x] 3.5 会话管理：会话列表/创建/删除/改名（服务层已完成）
- [ ] 3.6 AI 对话：发送/流式/错误处理
- [ ] 3.7 Markdown 渲染：任务详情 + AI 气泡

### 阶段 4：语音与派发能力
- [ ] 4.1 录音：WAV 输出 + 权限检测
- [ ] 4.2 语音转文字：Token 获取 + 上传
- [ ] 4.3 语音创建任务：模型抽取 + 规则兜底
- [ ] 4.4 派发候选：接口接入 + 选择映射

### 阶段 5：窗口与系统集成
- [ ] 5.1 主窗口行为：尺寸/最小值/透明
- [ ] 5.2 系统托盘：隐藏/显示/退出
- [ ] 5.3 小窗/悬浮窗：无边框/置顶/拖拽
- [ ] 5.4 通信：未读任务同步 + 双击恢复主窗

### 阶段 6：联调、测试与发布
- [ ] 6.1 回归清单：任务/AI/语音/MQTT/托盘/小窗
- [ ] 6.2 日志/异常：覆盖主路径
- [ ] 6.3 打包：Windows 安装包/压缩包

## 变更记录

- 2025-xx-xx 初始化迁移进度文件
- 2025-xx-xx 补充分阶段迁移执行清单与 SQLite(Dapper) 方案
- 2025-xx-xx 创建解决方案与基础类库（WPF 项目待 Windows 创建）
- 2025-xx-xx 手动生成 WPF 项目骨架并加入解决方案
- 2025-xx-xx 完成配置/日志/SQLite Schema 与核心模型定义
- 2025-xx-xx 完成 HTTP/SSE 封装与资源目录骨架
- 2025-xx-xx 完成 MQTT 基础连接与订阅框架
- 2025-xx-xx 完成本地仓储（Dapper + SQLite）与 Schema 初始化骨架
- 2025-xx-xx 完成 Task/Conversation 服务层
- 2025-xx-xx 任务列表 ViewModel 与 WPF 骨架
- 2025-xx-xx AI 对话服务层与 ViewModel 骨架
- 2025-xx-xx AI 对话 UI 与 SSE 解析
- 2025-xx-xx Markdown 渲染接入
- 2025-xx-xx 任务详情与外部联动 + 语音创建任务骨架
- 2025-xx-xx 任务派发 UI 与 Unify API 接入
- 2025-xx-xx 工号输入与校验弹窗
- 2025-xx-xx 修改工号入口（主界面）
- 2025-xx-xx 补充分页任务窗口与任务表单入口
