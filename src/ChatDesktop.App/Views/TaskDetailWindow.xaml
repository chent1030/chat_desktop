<Window x:Class="ChatDesktop.App.Views.TaskDetailWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:md="clr-namespace:Markdig.Wpf;assembly=Markdig.Wpf"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:coreEnums="clr-namespace:ChatDesktop.Core.Enums;assembly=ChatDesktop.Core"
        Title="任务详情" Height="560" Width="760" WindowStartupLocation="CenterOwner"
        Background="#F4F6FA">
  <Grid Margin="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <Border Grid.Row="0" Background="White" CornerRadius="12" Padding="16"
            BorderBrush="#E6E9F0" BorderThickness="1"
            materialDesign:ShadowAssist.ShadowDepth="Depth1">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <Ellipse Width="10" Height="10" Margin="0,6,10,0"
                 Fill="{Binding Task.Priority, Converter={StaticResource PriorityToBrushConverter}}" />

        <StackPanel Grid.Column="1">
          <TextBlock Text="{Binding Title}" FontSize="18" FontWeight="SemiBold" TextWrapping="Wrap" />
          <WrapPanel Margin="0,10,0,0">
            <Border CornerRadius="8" Padding="8,2" Margin="0,0,6,6">
              <Border.Style>
                <Style TargetType="Border">
                  <Setter Property="Background" Value="#FFEBEE" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding IsRead}" Value="True">
                      <Setter Property="Background" Value="#E8F5E9" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>
              <TextBlock>
                <TextBlock.Style>
                  <Style TargetType="TextBlock">
                    <Setter Property="Text" Value="未读" />
                    <Setter Property="Foreground" Value="#C62828" />
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding IsRead}" Value="True">
                        <Setter Property="Text" Value="已读" />
                        <Setter Property="Foreground" Value="#2E7D32" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </TextBlock.Style>
              </TextBlock>
            </Border>
            <Border CornerRadius="8" Padding="8,2" Margin="0,0,6,6">
              <Border.Style>
                <Style TargetType="Border">
                  <Setter Property="Background" Value="#FFF3E0" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                      <Setter Property="Background" Value="#E8F5E9" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>
              <TextBlock>
                <TextBlock.Style>
                  <Style TargetType="TextBlock">
                    <Setter Property="Text" Value="未完成" />
                    <Setter Property="Foreground" Value="#EF6C00" />
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                        <Setter Property="Text" Value="已完成" />
                        <Setter Property="Foreground" Value="#2E7D32" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </TextBlock.Style>
              </TextBlock>
            </Border>
            <Border CornerRadius="8" Padding="8,2" Margin="0,0,6,6">
              <Border.Style>
                <Style TargetType="Border">
                  <Setter Property="Background" Value="#FFF3E0" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding Task.Priority}" Value="{x:Static coreEnums:Priority.High}">
                      <Setter Property="Background" Value="#FFEBEE" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Task.Priority}" Value="{x:Static coreEnums:Priority.Low}">
                      <Setter Property="Background" Value="#E8F5E9" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>
              <TextBlock>
                <TextBlock.Style>
                  <Style TargetType="TextBlock">
                    <Setter Property="Text" Value="中" />
                    <Setter Property="Foreground" Value="#EF6C00" />
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding Task.Priority}" Value="{x:Static coreEnums:Priority.High}">
                        <Setter Property="Text" Value="高" />
                        <Setter Property="Foreground" Value="#C62828" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Task.Priority}" Value="{x:Static coreEnums:Priority.Low}">
                        <Setter Property="Text" Value="低" />
                        <Setter Property="Foreground" Value="#2E7D32" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </TextBlock.Style>
              </TextBlock>
            </Border>
            <Border CornerRadius="8" Padding="8,2" Margin="0,0,6,6">
              <Border.Style>
                <Style TargetType="Border">
                  <Setter Property="Background" Value="#ECEFF1" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding DueDate}" Value="{x:Null}">
                      <Setter Property="Background" Value="#F3F4F6" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>
              <TextBlock>
                <TextBlock.Style>
                  <Style TargetType="TextBlock">
                    <Setter Property="Text" Value="{Binding DueDate, StringFormat=截止 {0:yyyy-MM-dd HH:mm}}" />
                    <Setter Property="Foreground" Value="#607D8B" />
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding DueDate}" Value="{x:Null}">
                        <Setter Property="Text" Value="无截止" />
                        <Setter Property="Foreground" Value="#9AA1AE" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </TextBlock.Style>
              </TextBlock>
            </Border>
          </WrapPanel>
          <WrapPanel Margin="0,8,0,0">
            <materialDesign:Chip Content="{Binding Tags}" Margin="0,0,6,6">
              <materialDesign:Chip.Style>
                <Style TargetType="materialDesign:Chip">
                  <Setter Property="Visibility" Value="Visible" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding Tags}" Value="{x:Null}">
                      <Setter Property="Visibility" Value="Collapsed" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Tags}" Value="">
                      <Setter Property="Visibility" Value="Collapsed" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </materialDesign:Chip.Style>
            </materialDesign:Chip>
          </WrapPanel>
        </StackPanel>

        <Button Grid.Column="2" Style="{StaticResource MaterialDesignFlatButton}"
                Command="{Binding CloseCommand}">
          <materialDesign:PackIcon Kind="Close" Width="18" Height="18" />
        </Button>
      </Grid>
    </Border>

    <Border Grid.Row="1" Margin="0,12,0,12" Background="White" CornerRadius="12" Padding="16"
            BorderBrush="#E6E9F0" BorderThickness="1"
            materialDesign:ShadowAssist.ShadowDepth="Depth1">
      <Grid>
        <md:MarkdownViewer Markdown="{Binding Description}"
                           Visibility="{Binding Description, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
        <TextBlock Text="无描述" Foreground="#98A0AA" HorizontalAlignment="Center" VerticalAlignment="Center"
                   Visibility="{Binding Description, Converter={StaticResource StringNotEmptyToVisibilityConverter}, ConverterParameter=Invert}" />
      </Grid>
    </Border>

    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
      <Button Style="{StaticResource MaterialDesignOutlinedButton}" Command="{Binding DispatchCommand}" Margin="0,0,8,0"
              Visibility="{Binding AllowDispatch, Converter={StaticResource BooleanToVisibilityConverter}}">
        <TextBlock Text="任务派发" />
      </Button>
      <Button Style="{StaticResource MaterialDesignRaisedButton}" Command="{Binding HandleCommand}" Margin="0,0,8,0"
              Visibility="{Binding CanHandle, Converter={StaticResource BooleanToVisibilityConverter}}">
        <TextBlock Text="处理" />
      </Button>
      <Button Style="{StaticResource MaterialDesignFlatButton}" Command="{Binding CloseCommand}">
        <TextBlock Text="关闭" />
      </Button>
    </StackPanel>
  </Grid>
</Window>
