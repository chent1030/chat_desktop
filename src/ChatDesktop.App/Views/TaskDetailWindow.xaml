<Window x:Class="ChatDesktop.App.Views.TaskDetailWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:md="clr-namespace:Markdig.Wpf;assembly=Markdig.Wpf"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:coreEnums="clr-namespace:ChatDesktop.Core.Enums;assembly=ChatDesktop.Core"
        Title="任务详情" Height="560" Width="760" WindowStartupLocation="CenterOwner"
        Background="#F4F6FA">
  <Grid Margin="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <Border Grid.Row="0" Background="White" CornerRadius="12" Padding="16"
            BorderBrush="#E6E9F0" BorderThickness="1"
            materialDesign:ShadowAssist.ShadowDepth="Depth1">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <Ellipse Width="10" Height="10" Margin="0,6,10,0"
                 Fill="{Binding Task.Priority, Converter={StaticResource PriorityToBrushConverter}}" />

        <StackPanel Grid.Column="1">
          <TextBlock Text="{Binding Title}" FontSize="18" FontWeight="SemiBold" TextWrapping="Wrap" />
          <WrapPanel Margin="0,10,0,0">
            <Border Background="#EEF2FF" CornerRadius="8" Padding="8,2" Margin="0,0,6,6">
              <TextBlock Text="{Binding IsRead, StringFormat=已读: {0}}" Foreground="#5C6BC0" />
            </Border>
            <Border Background="#FFF3E0" CornerRadius="8" Padding="8,2" Margin="0,0,6,6">
              <TextBlock Text="{Binding IsCompleted, StringFormat=完成: {0}}" Foreground="#FB8C00" />
            </Border>
            <Border Background="#E8F5E9" CornerRadius="8" Padding="8,2" Margin="0,0,6,6">
              <TextBlock Text="{Binding Task.Source}" Foreground="#43A047" />
            </Border>
            <Border Background="#ECEFF1" CornerRadius="8" Padding="8,2" Margin="0,0,6,6">
              <TextBlock Text="{Binding DueDate, StringFormat=截止 {0:yyyy-MM-dd HH:mm}}" Foreground="#607D8B" />
              <Border.Style>
                <Style TargetType="Border">
                  <Setter Property="Visibility" Value="Visible" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding DueDate}" Value="{x:Null}">
                      <Setter Property="Visibility" Value="Collapsed" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>
            </Border>
          </WrapPanel>
          <WrapPanel Margin="0,8,0,0">
            <materialDesign:Chip Content="{Binding Tags}" Margin="0,0,6,6">
              <materialDesign:Chip.Style>
                <Style TargetType="materialDesign:Chip">
                  <Setter Property="Visibility" Value="Visible" />
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding Tags}" Value="{x:Null}">
                      <Setter Property="Visibility" Value="Collapsed" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Tags}" Value="">
                      <Setter Property="Visibility" Value="Collapsed" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </materialDesign:Chip.Style>
            </materialDesign:Chip>
          </WrapPanel>
        </StackPanel>

        <Button Grid.Column="2" Style="{StaticResource MaterialDesignFlatButton}"
                Command="{Binding CloseCommand}">
          <materialDesign:PackIcon Kind="Close" Width="18" Height="18" />
        </Button>
      </Grid>
    </Border>

    <Border Grid.Row="1" Margin="0,12,0,12" Background="White" CornerRadius="12" Padding="16"
            BorderBrush="#E6E9F0" BorderThickness="1"
            materialDesign:ShadowAssist.ShadowDepth="Depth1">
      <Grid>
        <md:MarkdownViewer Markdown="{Binding Description}"
                           Visibility="{Binding Description, Converter={StaticResource StringNotEmptyToVisibilityConverter}}" />
        <TextBlock Text="无描述" Foreground="#98A0AA" HorizontalAlignment="Center" VerticalAlignment="Center"
                   Visibility="{Binding Description, Converter={StaticResource StringNotEmptyToVisibilityConverter}, ConverterParameter=Invert}" />
      </Grid>
    </Border>

    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
      <Button Style="{StaticResource MaterialDesignOutlinedButton}" Command="{Binding DispatchCommand}" Margin="0,0,8,0"
              Visibility="{Binding AllowDispatch, Converter={StaticResource BooleanToVisibilityConverter}}">
        <TextBlock Text="任务派发" />
      </Button>
      <Button Style="{StaticResource MaterialDesignRaisedButton}" Command="{Binding HandleCommand}" Margin="0,0,8,0"
              Visibility="{Binding CanHandle, Converter={StaticResource BooleanToVisibilityConverter}}">
        <TextBlock Text="处理" />
      </Button>
      <Button Style="{StaticResource MaterialDesignFlatButton}" Command="{Binding CloseCommand}">
        <TextBlock Text="关闭" />
      </Button>
    </StackPanel>
  </Grid>
</Window>
